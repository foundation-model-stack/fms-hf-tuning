controller-metrics:
  - name: trainer_state
    class: TrainingState
  - name: eval_loss_window
    class: HistoryBasedMetric
    arguments:
      window-size: 1
operations:
  - name: hfwithpatience
    class: HFControlsWithPatience
    arguments:
      patience-threshold: 3
controllers:
  - name: epoch-level-eval-loss
    triggers:
      - on_epoch_end
    rule: len(eval_loss_window["metrics"]) > 0 and eval_loss_window["metrics"][-1]["eval_loss"] > 2.2 and trainer_state["epoch"] > 2
    operations:
      - hfwithpatience.should_training_stop